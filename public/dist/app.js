var myYelp=angular.module("myYelp",[]);myYelp.controller("yelpController",["$http","$q",function(a,e){vm=this,vm.yelpBusinesses=[],vm.term=["american","chinese","markets","gas stations","liquor stores","bars","korean","mexican","gyms","antiques","cafe","electronics","clothes","beauty salons","hotels","donuts","bakery","mediterranean","italian","drug stores","chiropractors"],vm.d3Data=[{stars:"1.0-1.9",name:"unclaimed"},{stars:"1.0-1.9",name:"claimed"},{stars:"2.0-2.9",name:"unclaimed"},{stars:"2.0-2.9",name:"claimed"},{stars:"3.0-3.9",name:"unclaimed"},{stars:"3.0-3.9",name:"claimed"},{stars:"4.0-5.0",name:"unclaimed"},{stars:"4.0-5.0",name:"claimed"}],vm.dataOrganizer=function(a){for(var e=0;e<a.length;e++)for(var s=0;s<a[e].data.businesses.length;s++){var t={};a[e].data.businesses[s].id==t.id?console.log("skip"):(t.name=a[e].data.businesses[s].name,t.claimed=a[e].data.businesses[s].is_claimed,t.rating=a[e].data.businesses[s].rating,t.reviews=a[e].data.businesses[s].review_count,t.id=a[e].data.businesses[s].id,vm.yelpBusinesses.push(t))}return vm.yelpBusinesses},vm.d3dataOrganizer=function(a){for(var e=[],s=[],t=[],n=[],r=[],l=[],m=[],i=[],v=0;v<a.length;v++){var u=a[v].rating,d=a[v].claimed;2>u&&0==d?e.push(a[v]):2>u&&1==d?s.push(a[v]):3>u&&0==d?t.push(a[v]):3>u&&1==d?n.push(a[v]):4>u&&0==d?r.push(a[v]):4>u&&1==d?l.push(a[v]):5>u&&0==d?m.push(a[v]):5>u&&1==d&&i.push(a[v])}return vm.d3Data[0].value=e.length,vm.d3Data[1].value=s.length,vm.d3Data[2].value=t.length,vm.d3Data[3].value=n.length,vm.d3Data[4].value=r.length,vm.d3Data[5].value=l.length,vm.d3Data[6].value=m.length,vm.d3Data[7].value=i.length,console.log(l.length),vm.d3Data},vm.submit=function(){vm.httpGetter=function(s){for(var t=[],n=0;n<s.length;n++)for(var r=0;2>r;r++)vm.reqNum=20*r,t.push(a.get("http://localhost:8080/businesses/"+vm.location+"/"+vm.term[n]+"/"+vm.reqNum));e.all(t).then(function(a){var e=vm.dataOrganizer(a);console.log(e);var s=vm.d3dataOrganizer(e);console.log(s),vm.barGraph=d3plus.viz().container("div#graph").data(s).type("bar").id("name").x("stars").y("value").draw()}),$("#graph").on("click",function(a){for(var e=[],s=0;s<vm.d3Data.length;s++)if(a.target.__data__.stars==vm.d3Data[s].stars){var t={};t.name=vm.d3Data[s].name,t.value=vm.d3Data[s].value,e.push(t)}d3plus.viz().container("#pie").data(e).type("pie").id("name").size("value").draw()})},vm.httpGetter(vm.term)}}]);