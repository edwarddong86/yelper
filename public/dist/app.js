var myYelp=angular.module("myYelp",["angular-loading-bar"]);myYelp.controller("yelpController",["$http","$q",function(e,a){vm=this,vm.yelpBusinesses=[],vm.hideElement="true",vm.term=["american","chinese","markets","gas stations","liquor stores","bars","korean","mexican","gyms","antiques","cafe","electronics","clothes","beauty salons","hotels","donuts","bakery","mediterranean","italian","drug stores","chiropractors"],vm.d3Data=[{stars:"1.0-1.9",name:"unclaimed",color:"#92ffff"},{stars:"1.0-1.9",name:"claimed",color:"#032832"},{stars:"2.0-2.9",name:"unclaimed",color:"#92ffff"},{stars:"2.0-2.9",name:"claimed",color:"#032832"},{stars:"3.0-3.9",name:"unclaimed",color:"#92ffff"},{stars:"3.0-3.9",name:"claimed",color:"#032832"},{stars:"4.0-5.0",name:"unclaimed",color:"#92ffff"},{stars:"4.0-5.0",name:"claimed",color:"#032832"}],vm.dataOrganizer=function(e){for(var a=0;a<e.length;a++)for(var s=0;s<e[a].data.businesses.length;s++){var t={};e[a].data.businesses[s].id==t.id?console.log("skip"):(t.name=e[a].data.businesses[s].name,t.claimed=e[a].data.businesses[s].is_claimed,t.rating=e[a].data.businesses[s].rating,t.reviews=e[a].data.businesses[s].review_count,t.id=e[a].data.businesses[s].id,vm.yelpBusinesses.push(t))}return vm.yelpBusinesses},vm.d3dataOrganizer=function(e){for(var a=[],s=[],t=[],n=[],r=[],i=[],m=[],o=[],l=0;l<e.length;l++){var u=e[l].rating,d=e[l].claimed;2>u&&0==d?a.push(e[l]):2>u&&1==d?s.push(e[l]):3>u&&0==d?t.push(e[l]):3>u&&1==d?n.push(e[l]):4>u&&0==d?r.push(e[l]):4>u&&1==d?i.push(e[l]):5>u&&0==d?m.push(e[l]):5>u&&1==d&&o.push(e[l])}return vm.d3Data[0].businesses=a.length,vm.d3Data[1].businesses=s.length,vm.d3Data[2].businesses=t.length,vm.d3Data[3].businesses=n.length,vm.d3Data[4].businesses=r.length,vm.d3Data[5].businesses=i.length,vm.d3Data[6].businesses=m.length,vm.d3Data[7].businesses=o.length,vm.d3Data},vm.enter=function(){13===event.keyCode&&(vm.httpGetter=function(s){for(var t=[],n=0;n<s.length;n++)for(var r=0;2>r;r++)vm.reqNum=20*r,t.push(e.get("http://localhost:8080/businesses/"+vm.location+"/"+vm.term[n]+"/"+vm.reqNum));a.all(t).then(function(e){vm.hideSearch="true",vm.showElement="true";var a=vm.dataOrganizer(e),s=vm.d3dataOrganizer(a);vm.barGraph=d3plus.viz().container("div#graph").data(s).type("bar").id("name").x("stars").y("businesses").color("color").draw()}),$("#graph").on("click",function(e){vm.ratings=e.target.__data__.stars,vm.showTag="true";for(var a=[],s=0;s<vm.d3Data.length;s++)if(vm.ratings==vm.d3Data[s].stars){var t={};t.name=vm.d3Data[s].name,t.businesses=vm.d3Data[s].businesses,"unclaimed"==t.name?(t.color="#92ffff",a.push(t)):"claimed"==t.name&&(t.color="#032832",a.push(t))}d3plus.viz().container("#pie").data(a).type("pie").id("name").size("businesses").color("color").draw(),vm.showTag="true"})},vm.httpGetter(vm.term))},$("#reload").click(function(){location.reload()})}]),(new WOW).init();