var myYelp=angular.module("myYelp",["angular-loading-bar"]);myYelp.controller("yelpController",["$http","$q",function(a,e){vm=this,vm.yelpBusinesses=[],vm.hideButton="true",vm.term=["american","chinese","markets","gas stations","liquor stores","bars","korean","mexican","gyms","antiques","cafe","electronics","clothes","beauty salons","hotels","donuts","bakery","mediterranean","italian","drug stores","chiropractors"],vm.d3Data=[{stars:"1.0-1.9",name:"unclaimed",color:"#636365"},{stars:"1.0-1.9",name:"claimed",color:"#cc0f00"},{stars:"2.0-2.9",name:"unclaimed",color:"#636365"},{stars:"2.0-2.9",name:"claimed",color:"#cc0f00"},{stars:"3.0-3.9",name:"unclaimed",color:"#636365"},{stars:"3.0-3.9",name:"claimed",color:"#cc0f00"},{stars:"4.0-5.0",name:"unclaimed",color:"#636365"},{stars:"4.0-5.0",name:"claimed",color:"#cc0f00"}],vm.dataOrganizer=function(a){for(var e=0;e<a.length;e++)for(var t=0;t<a[e].data.businesses.length;t++){var s={};a[e].data.businesses[t].id==s.id?console.log("skip"):(s.name=a[e].data.businesses[t].name,s.claimed=a[e].data.businesses[t].is_claimed,s.rating=a[e].data.businesses[t].rating,s.reviews=a[e].data.businesses[t].review_count,s.id=a[e].data.businesses[t].id,vm.yelpBusinesses.push(s))}return vm.yelpBusinesses},vm.d3dataOrganizer=function(a){for(var e=[],t=[],s=[],r=[],n=[],l=[],i=[],o=[],m=0;m<a.length;m++){var u=a[m].rating,c=a[m].claimed;2>u&&0==c?e.push(a[m]):2>u&&1==c?t.push(a[m]):3>u&&0==c?s.push(a[m]):3>u&&1==c?r.push(a[m]):4>u&&0==c?n.push(a[m]):4>u&&1==c?l.push(a[m]):5>u&&0==c?i.push(a[m]):5>u&&1==c&&o.push(a[m])}return vm.d3Data[0].value=e.length,vm.d3Data[1].value=t.length,vm.d3Data[2].value=s.length,vm.d3Data[3].value=r.length,vm.d3Data[4].value=n.length,vm.d3Data[5].value=l.length,vm.d3Data[6].value=i.length,vm.d3Data[7].value=o.length,vm.d3Data},vm.enter=function(){13==event.keyCode&&(vm.httpGetter=function(t){for(var s=[],r=0;r<t.length;r++)for(var n=0;2>n;n++)vm.reqNum=20*n,s.push(a.get("http://localhost:8080/businesses/"+vm.location+"/"+vm.term[r]+"/"+vm.reqNum));e.all(s).then(function(a){vm.hideSearch="true",vm.showButton="true";var e=vm.dataOrganizer(a),t=vm.d3dataOrganizer(e);vm.barGraph=d3plus.viz().container("div#graph").data(t).type("bar").id("name").x("stars").y("value").color("color").draw()}),$("#graph").on("click",function(a){for(var e=[],t=0;t<vm.d3Data.length;t++)if(a.target.__data__.stars==vm.d3Data[t].stars){var s={};s.name=vm.d3Data[t].name,s.value=vm.d3Data[t].value,"unclaimed"==s.name?(s.color="#636365",e.push(s)):"claimed"==s.name&&(s.color="#cc0f00",e.push(s))}d3plus.viz().container("#pie").data(e).type("pie").id("name").size("value").color("color").draw()})},vm.httpGetter(vm.term))},$("#reload").click(function(){location.reload()})}]),(new WOW).init();